<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»£ç æ¸…ç†éªŒè¯æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section h2 {
            margin-top: 0;
            color: #333;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .status.pass {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.fail {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>ğŸ§¹ ä»£ç æ¸…ç†éªŒè¯æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>1. æ¨¡å—åŠ è½½æµ‹è¯•</h2>
        <div id="module-test-result">ç­‰å¾…æµ‹è¯•...</div>
        <button onclick="testModuleLoading()">è¿è¡Œæµ‹è¯•</button>
    </div>

    <div class="test-section">
        <h2>2. æ ¸å¿ƒç±»æ£€æŸ¥</h2>
        <div id="core-classes-result">ç­‰å¾…æµ‹è¯•...</div>
        <button onclick="testCoreClasses()">è¿è¡Œæµ‹è¯•</button>
    </div>

    <div class="test-section">
        <h2>3. æ¨¡æ¿ç³»ç»Ÿæ£€æŸ¥</h2>
        <div id="template-system-result">ç­‰å¾…æµ‹è¯•...</div>
        <button onclick="testTemplateSystem()">è¿è¡Œæµ‹è¯•</button>
    </div>

    <div class="test-section">
        <h2>4. é¼ æ ‡æ‹–å½±åŠŸèƒ½æ£€æŸ¥</h2>
        <div id="mouse-trail-result">ç­‰å¾…æµ‹è¯•...</div>
        <button onclick="testMouseTrail()">è¿è¡Œæµ‹è¯•</button>
    </div>

    <div class="test-section">
        <h2>5. å¯¼å‡ºåŠŸèƒ½æ£€æŸ¥</h2>
        <div id="export-check-result">ç­‰å¾…æµ‹è¯•...</div>
        <button onclick="testExports()">è¿è¡Œæµ‹è¯•</button>
    </div>

    <script type="module">
        import { Vector } from './src/core/Vector.js';
        import { Ray } from './src/core/Ray.js';
        import { GameObject } from './src/core/GameObject.js';
        import { OpticalComponent } from './src/core/OpticalComponent.js';
        import { HistoryManager } from './src/managers/HistoryManager.js';
        import { TEMPLATE_CATEGORIES, TEMPLATE_LIBRARY } from './src/diagram/templates/index.js';
        import { getState } from './src/state/GlobalState.js';

        // å¯¼å‡ºåˆ°å…¨å±€ä¾›æµ‹è¯•ä½¿ç”¨
        window.testModules = {
            Vector,
            Ray,
            GameObject,
            OpticalComponent,
            HistoryManager,
            TEMPLATE_CATEGORIES,
            TEMPLATE_LIBRARY,
            getState
        };

        window.testModuleLoading = function() {
            const resultDiv = document.getElementById('module-test-result');
            try {
                const modules = window.testModules;
                if (modules.Vector && modules.Ray && modules.GameObject && 
                    modules.OpticalComponent && modules.HistoryManager) {
                    resultDiv.innerHTML = '<div class="status pass">âœ“ æ‰€æœ‰æ¨¡å—åŠ è½½æˆåŠŸ</div>';
                } else {
                    resultDiv.innerHTML = '<div class="status fail">âœ— éƒ¨åˆ†æ¨¡å—åŠ è½½å¤±è´¥</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="status fail">âœ— æ¨¡å—åŠ è½½é”™è¯¯: ${error.message}</div>`;
            }
        };

        window.testCoreClasses = function() {
            const resultDiv = document.getElementById('core-classes-result');
            const modules = window.testModules;
            let html = '';
            
            const classes = [
                { name: 'Vector', cls: modules.Vector },
                { name: 'Ray', cls: modules.Ray },
                { name: 'GameObject', cls: modules.GameObject },
                { name: 'OpticalComponent', cls: modules.OpticalComponent },
                { name: 'HistoryManager', cls: modules.HistoryManager }
            ];

            let allPass = true;
            classes.forEach(({ name, cls }) => {
                if (cls && typeof cls === 'function') {
                    html += `<div class="status pass">âœ“ ${name} å·²å®šä¹‰</div>`;
                } else {
                    html += `<div class="status fail">âœ— ${name} æœªå®šä¹‰</div>`;
                    allPass = false;
                }
            });

            if (allPass) {
                html += '<div class="status info">æ‰€æœ‰æ ¸å¿ƒç±»æ£€æŸ¥é€šè¿‡ï¼</div>';
            }

            resultDiv.innerHTML = html;
        };

        window.testTemplateSystem = function() {
            const resultDiv = document.getElementById('template-system-result');
            const modules = window.testModules;
            let html = '';

            try {
                // æ£€æŸ¥ TEMPLATE_CATEGORIES
                if (modules.TEMPLATE_CATEGORIES) {
                    const categories = Object.keys(modules.TEMPLATE_CATEGORIES);
                    html += `<div class="status pass">âœ“ TEMPLATE_CATEGORIES å·²å®šä¹‰ (${categories.length} ä¸ªåˆ†ç±»)</div>`;
                    html += `<pre>${categories.join(', ')}</pre>`;
                } else {
                    html += '<div class="status fail">âœ— TEMPLATE_CATEGORIES æœªå®šä¹‰</div>';
                }

                // æ£€æŸ¥ TEMPLATE_LIBRARY
                if (modules.TEMPLATE_LIBRARY) {
                    const templates = Object.keys(modules.TEMPLATE_LIBRARY);
                    html += `<div class="status pass">âœ“ TEMPLATE_LIBRARY å·²å®šä¹‰ (${templates.length} ä¸ªæ¨¡æ¿)</div>`;
                } else {
                    html += '<div class="status fail">âœ— TEMPLATE_LIBRARY æœªå®šä¹‰</div>';
                }

                // æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤å¯¼å‡º
                html += '<div class="status info">æ— é‡å¤å¯¼å‡ºé”™è¯¯</div>';

            } catch (error) {
                html += `<div class="status fail">âœ— æ¨¡æ¿ç³»ç»Ÿé”™è¯¯: ${error.message}</div>`;
            }

            resultDiv.innerHTML = html;
        };

        window.testMouseTrail = function() {
            const resultDiv = document.getElementById('mouse-trail-result');
            const modules = window.testModules;
            let html = '';

            try {
                // æ£€æŸ¥ GlobalState ä¸­çš„ showArrowTrail
                const showArrowTrail = modules.getState('showArrowTrail');
                
                if (showArrowTrail === false) {
                    html += '<div class="status pass">âœ“ showArrowTrail å·²ç¦ç”¨ (GlobalState)</div>';
                } else {
                    html += `<div class="status fail">âœ— showArrowTrail æœªç¦ç”¨: ${showArrowTrail}</div>`;
                }

                html += '<div class="status info">é¼ æ ‡æ‹–å½±åŠŸèƒ½å·²å®Œå…¨ç¦ç”¨</div>';

            } catch (error) {
                html += `<div class="status fail">âœ— æ£€æŸ¥é”™è¯¯: ${error.message}</div>`;
            }

            resultDiv.innerHTML = html;
        };

        window.testExports = function() {
            const resultDiv = document.getElementById('export-check-result');
            let html = '';

            try {
                // å°è¯•å¯¼å…¥ diagram/index.js æ£€æŸ¥å¯¼å‡º
                import('./src/diagram/index.js').then(diagramModule => {
                    if (diagramModule.TEMPLATE_CATEGORIES) {
                        html += '<div class="status pass">âœ“ TEMPLATE_CATEGORIES ä» diagram/index.js å¯¼å‡ºæˆåŠŸ</div>';
                    } else {
                        html += '<div class="status fail">âœ— TEMPLATE_CATEGORIES æœªä» diagram/index.js å¯¼å‡º</div>';
                    }

                    // æ£€æŸ¥æ˜¯å¦æœ‰ TEMPLATE_CATEGORIES_NEW (æ—§çš„ä¸´æ—¶ä¿®å¤)
                    if (diagramModule.TEMPLATE_CATEGORIES_NEW) {
                        html += '<div class="status fail">âœ— å‘ç°æ—§çš„ TEMPLATE_CATEGORIES_NEW å¯¼å‡º</div>';
                    } else {
                        html += '<div class="status pass">âœ“ æ— æ—§çš„ TEMPLATE_CATEGORIES_NEW å¯¼å‡º</div>';
                    }

                    html += '<div class="status info">å¯¼å‡ºæ£€æŸ¥å®Œæˆ</div>';
                    resultDiv.innerHTML = html;
                }).catch(error => {
                    resultDiv.innerHTML = `<div class="status fail">âœ— å¯¼å…¥é”™è¯¯: ${error.message}</div>`;
                });

            } catch (error) {
                resultDiv.innerHTML = `<div class="status fail">âœ— æ£€æŸ¥é”™è¯¯: ${error.message}</div>`;
            }
        };

        // è‡ªåŠ¨è¿è¡Œæ‰€æœ‰æµ‹è¯•
        setTimeout(() => {
            console.log('è‡ªåŠ¨è¿è¡Œæ‰€æœ‰æµ‹è¯•...');
            testModuleLoading();
            testCoreClasses();
            testTemplateSystem();
            testMouseTrail();
            testExports();
        }, 500);
    </script>
</body>
</html>
