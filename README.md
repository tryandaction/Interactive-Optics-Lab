# 交互式光学实验室 (Interactive Optics Lab)

一个功能强大、物理精确、界面美观、交互流畅的跨平台光学仿真工具，特别侧重于原子分子光物理(AMO)和量子精密测量等现代光学实验的模拟。

## 🎉 最新更新 (v0.7)

- ✅ **协作功能完整实现**：项目管理、权限控制、协作者邀请、协作会话管理
- ✅ **用户内容所有权跟踪**：元件创建时记录用户ID，为内容区分奠定基础
- ✅ **用户内容视觉过滤**：支持显示/隐藏/变暗不同用户的元件内容
- ✅ **AMO元件库扩展**：新增法拉第隔离器、法拉第旋光器、光隔离器等专业元件
- ✅ **元件视觉设计升级**：改进元件在工具栏和画布上的渲染效果
- ✅ **密码重置功能**：完整的邮箱验证和密码重置流程
- ✅ **箭头拖影控制**：新增拖影开关，可选择开启/关闭视觉效果
- ✅ **项目结构优化**：前后端分离，代码组织更清晰
- ✅ **内存泄漏修复**：优化箭头动画状态管理
- ✅ **性能提升**：减少不必要的渲染操作

## 🚀 功能特性

### ✅ 核心功能
- **丰富的元件库**：光源、透镜、反射镜、棱镜、光栅、偏振元件、分束器、探测器等
- **精确的物理模拟**：反射、折射、色散、衍射、偏振、干涉、高斯光束传输
- **完整的操作历史**：撤销/重做功能
- **多选操作**：元件选择、移动、旋转、删除
- **专业的UI界面**：顶部菜单栏、右侧检查器面板、标签页设计
- **灵活的视图控制**：缩放、平移、重置视图
- **场景管理**：本地保存/加载/管理，支持云端同步

### ✅ 高级功能
- **用户系统**：注册、登录、JWT认证、密码重置
- **云端场景存储**：多设备同步、场景分享
- **协作功能**：项目管理、权限控制、协作者邀请、协作会话管理
- **用户内容跟踪**：元件所有权记录，为内容区分显示奠定基础
- **主题系统**：动态主题切换、界面和画布主题
- **偏振模拟**：完整的琼斯矩阵实现
- **AMO元件扩展**：新增法拉第隔离器、电光调制器、原子蒸汽池、法布里-珀罗标准具
- **元件视觉升级**：更真实的实验室器件外观设计
- **性能优化**：自适应渲染、智能缓存、内存泄漏防护
- **箭头拖影控制**：可选择开启/关闭箭头拖影效果

## 📁 项目结构

```
OpticsLab/
├── 📁 backend/              # 后端API服务器
│   ├── package.json        # 后端依赖配置
│   ├── package-lock.json   # 锁定文件
│   └── server.js          # 后端服务器主文件
├── 📁 frontend/             # 前端应用
│   ├── index.html          # 主界面HTML
│   ├── reset-password.html # 密码重置页面
│   ├── style.css           # 样式表
│   ├── main.js             # 前端主逻辑
│   ├── user.js             # 用户管理（含密码重置）
│   ├── components.js       # 光学元件类定义
│   ├── ray.js              # 光线追踪引擎
│   ├── vector.js           # 向量数学库
│   ├── history.js          # 操作历史管理
│   ├── sceneManager.js     # 场景管理
│   ├── interactionEnhancer.js # 交互增强
│   ├── package.json        # 前端依赖配置
│   └── package-lock.json   # 锁定文件
├── 📁 presets/              # 预设场景
│   └── preset_double_slit.json
├── .env                    # 环境配置
├── .gitignore              # Git忽略规则
├── README.md               # 项目说明
├── UserGuide.md            # 用户指南
├── 开发方案.md             # 开发计划
├── BACKEND_SETUP.md        # 后端设置说明
├── start-dev.sh            # Linux/Mac启动脚本
└── start-dev.ps1           # Windows启动脚本
```

## 🛠️ 安装和运行

### 环境要求
- **Node.js** 16.0.0 或更高版本
- **MongoDB** 4.4 或更高版本（用于云端功能）
- 现代浏览器（Chrome、Firefox、Safari、Edge）

### 安装步骤

1. **克隆项目**
   ```bash
   git clone <repository-url>
   cd OpticsLab
   ```

2. **安装前端依赖**
    ```bash
    cd frontend
    npm install
    cd ..
    ```

3. **安装后端依赖**
    ```bash
    cd backend
    npm install
    cd ..
    ```

4. **配置环境变量**
   编辑 `.env` 文件：
   ```env
   PORT=3000
   NODE_ENV=development
   MONGODB_URI=mongodb://localhost:27017/opticslab
   JWT_SECRET=your-super-secret-jwt-key-change-in-production
   FRONTEND_URL=http://localhost:8080
   ```

5. **启动MongoDB**
   ```bash
   # 确保MongoDB服务正在运行
   mongod
   ```

### 运行项目

#### 方式一：分别启动前后端
```bash
# 终端1：启动后端API服务器
cd backend
npm run dev

# 终端2：启动前端服务器
cd frontend
python -m http.server 8080
```

#### 方式二：使用便捷脚本（推荐）
```bash
# Linux/Mac
./start-dev.sh

# Windows PowerShell
.\start-dev.ps1
```

### 访问应用
打开浏览器访问：`http://localhost:8080`

## 🎯 使用指南

### 基本操作
1. **添加元件**：点击左侧工具栏按钮，然后在画布上点击放置
2. **选择元件**：直接点击画布上的元件
3. **移动元件**：拖拽选中的元件
4. **旋转元件**：拖拽元件的角度控制柄，或选中后按R键
5. **多选操作**：Shift+点击或Ctrl+点击多个元件
6. **撤销/重做**：使用Ctrl+Z/Ctrl+Y或顶部按钮

### 高级功能
1. **用户注册登录**：点击顶部"登录/注册"按钮
2. **云端场景**：登录后可保存和加载云端场景
3. **场景分享**：通过分享链接与他人协作
4. **主题切换**：视图菜单中的主题选择器
5. **性能监控**：帮助菜单中的性能统计

### 键盘快捷键
- `Ctrl+N` - 新建场景
- `Ctrl+S` - 保存场景
- `Ctrl+E` - 导出场景
- `Ctrl+Z` - 撤销
- `Ctrl+Y` - 重做
- `Delete` - 删除选中元件
- `R` - 旋转元件
- `Shift+R` - 微调旋转
- `Space` - 切换光源启用状态
- `Esc` - 取消选择/工具

## 🔧 开发指南

### 代码结构
- **前端**：Vanilla JavaScript + HTML5 Canvas
- **后端**：Node.js + Express + MongoDB
- **物理引擎**：自定义光线追踪算法
- **UI框架**：自定义CSS + Flexbox布局

### 主要文件说明
- `main.js` - 前端主逻辑和事件处理
- `components.js` - 所有光学元件类定义
- `ray.js` - 光线追踪和物理计算引擎
- `user.js` - 用户认证和状态管理
- `backend/server.js` - 后端API服务器

### 扩展开发
1. **添加新元件**：在`components.js`中创建新类
2. **修改物理模型**：编辑`ray.js`中的计算逻辑
3. **添加新功能**：在`main.js`中实现交互逻辑
4. **样式定制**：修改`style.css`中的样式规则

## 📊 项目状态

### 🎯 当前版本 (v0.7)
- ✅ **第一阶段**：核心功能完善与体验优化
- ✅ **第二阶段**：非物理功能开发与用户体验优化
  - ✅ 用户系统与云同步（密码重置、场景分享等）
  - ✅ 交互功能优化（箭头拖影控制、多选操作等）
  - ✅ 性能与内存管理优化
- 🚧 **第三阶段**：AMO与量子光学元件库扩展（进行中）
  - ✅ 项目协作功能（项目管理、权限控制、协作者邀请、协作会话管理）
  - ✅ 用户内容所有权跟踪（元件创建时记录用户ID）
  - ✅ 用户内容视觉过滤（显示/隐藏/变暗不同用户的元件内容）
  - 🔄 元件视觉设计全面升级
  - ✅ 新增法拉第隔离器元件
  - ✅ 新增法拉第旋光器元件
  - ✅ 新增光隔离器元件
  - ⏳ 新增电光调制器元件
  - ⏳ 新增原子蒸汽池元件
  - ⏳ 新增法布里-珀罗标准具元件
- ⏳ **第四阶段**：物理模型深化（待开发）
- ⏳ **第五阶段**：高级功能与产品化（待开发）

## 🤝 贡献

欢迎提交Issue和Pull Request来改进项目！

## 📄 许可证


## 📞 联系

如有问题或建议，请通过Issue系统联系我们。
